{% extends "adminexpo/wrapper.html" %}
{% load home_extras %}
{% block content%}

    <div class="container">
        <form name="settingsform" id="settingsform">

            {% csrf_token %}

            <h3 class="mt-5">Специалисты</h3>

            <table class="table table-hover">
                <thead class="thead-default">
                <tr>
                    <th style="width: 5px"></th>
                    <th>ФИО</th>
                    <th>Номер телефона</th>
                    <th>Email</th>
                    <th>Проверка пройдена</th>
                    <th>Действия</th>
                </tr>
                </thead>
                <tbody id = 'tbodyServices'>
                {% for i in worker.works.servicelist %}
                    <tr id="tr_{{ forloop.counter }}">
                        <td style="width: 5px"></td>
                        <td>
                            <select id="service_{{ forloop.counter }}" class = "form-control" style="background-color: white; border: white" disabled>
                                {% for s in serviceList %}
                                    <option value="{{s.id}}" {% if i.id == s.id %} selected {% endif %}>{{ s.name }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>
                            <input id="price_{{ forloop.counter }}" type="number" class="form-control" value="{{ i.price }}" disabled style="background-color: white; border-color: white">
                        </td>
                        <td>
                            <button type="button" class="btn text-danger" id="edit_{{ forloop.counter }}" onclick="editService(this)" style="text-align: left; background-color: white">Изменить</button>
                            <button type="button" class="btn text-danger" id="delete_{{ forloop.counter }}" onclick="deleteService(this)" style="text-align: left; background-color: white">Удалить</button>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </form>

    <script>

    $('#settingsform').validate({

        submitHandler: function(form) {
            formsave();
            }
        }
    );
    function formsave() {

        var formData = new FormData();

        //Собираем конечный JSON

        var json = JSON.stringify({
            address: document.getElementById("id_address").value,
            email: document.getElementById("id_email").value,
            phone: document.getElementById("id_phone").value,
        });

        // добавить к пересылке ещё пару ключ - значение
        formData.append("data", json);
        formData.append("csrfmiddlewaretoken", document.getElementsByName("csrfmiddlewaretoken")[0].value);

        // отослать
        var xhr = new XMLHttpRequest();

        xhr.onreadystatechange = function() { // (3)
            if (xhr.readyState != 4) return;

            if (xhr.status != 200) {
                location.href = (xhr.responseText);
            } else {
                location.href = (xhr.responseText);
            }
        }

        xhr.open("POST", "save/", true);
        xhr.send(formData);
    }

</script>

{% endblock %}